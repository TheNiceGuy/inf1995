#include <avr/io.h>
#include <sensor.h>
#include <util/delay.h>

int16_t sensor_tableau[] = {
   604, /*  182 */
   597, /*  183 */
   588, /*  184 */
   579, /*  185 */
   573, /*  186 */
   565, /*  187 */
   559, /*  188 */
   551, /*  189 */
   545, /*  190 */
   537, /*  191 */
   532, /*  192 */
   525, /*  193 */
   519, /*  194 */
   512, /*  195 */
   507, /*  196 */
   501, /*  197 */
   496, /*  198 */
   490, /*  199 */
   485, /*  200 */
   479, /*  201 */
   475, /*  202 */
   470, /*  203 */
   465, /*  204 */
   460, /*  205 */
   455, /*  206 */
   451, /*  207 */
   447, /*  208 */
   442, /*  209 */
   438, /*  210 */
   434, /*  211 */
   430, /*  212 */
   426, /*  213 */
   423, /*  214 */
   419, /*  215 */
   415, /*  216 */
   411, /*  217 */
   408, /*  218 */
   404, /*  219 */
   401, /*  220 */
   397, /*  221 */
   394, /*  222 */
   390, /*  223 */
   387, /*  224 */
   385, /*  225 */
   382, /*  226 */
   379, /*  227 */
   375, /*  228 */
   372, /*  229 */
   370, /*  230 */
   367, /*  231 */
   364, /*  232 */
   361, /*  233 */
   359, /*  234 */
   356, /*  235 */
   354, /*  236 */
   351, /*  237 */
   349, /*  238 */
   346, /*  239 */
   343, /*  240 */
   341, /*  241 */
   339, /*  242 */
   336, /*  243 */
   334, /*  244 */
   332, /*  245 */
   330, /*  246 */
   328, /*  247 */
   326, /*  248 */
   323, /*  249 */
   321, /*  250 */
   319, /*  251 */
   317, /*  252 */
   315, /*  253 */
   313, /*  254 */
   311, /*  255 */
   309, /*  256 */
   307, /*  257 */
   306, /*  258 */
   304, /*  259 */
   302, /*  260 */
   300, /*  261 */
   298, /*  262 */
   297, /*  263 */
   295, /*  264 */
   293, /*  265 */
   292, /*  266 */
   290, /*  267 */
   288, /*  268 */
   287, /*  269 */
   285, /*  270 */
   283, /*  271 */
   281, /*  272 */
   280, /*  273 */
   279, /*  274 */
   277, /*  275 */
   276, /*  276 */
   274, /*  277 */
   273, /*  278 */
   271, /*  279 */
   270, /*  280 */
   268, /*  281 */
   267, /*  282 */
   266, /*  283 */
   264, /*  284 */
   263, /*  285 */
   261, /*  286 */
   260, /*  287 */
   259, /*  288 */
   258, /*  289 */
   256, /*  290 */
   255, /*  291 */
   254, /*  292 */
   252, /*  293 */
   251, /*  294 */
   250, /*  295 */
   249, /*  296 */
   247, /*  297 */
   246, /*  298 */
   245, /*  299 */
   244, /*  300 */
   243, /*  301 */
   242, /*  302 */
   241, /*  303 */
   240, /*  304 */
   238, /*  305 */
   237, /*  306 */
   236, /*  307 */
   235, /*  308 */
   234, /*  309 */
   233, /*  310 */
   232, /*  311 */
   231, /*  312 */
   230, /*  313 */
   229, /*  314 */
   228, /*  315 */
   227, /*  316 */
   226, /*  317 */
   225, /*  318 */
   224, /*  319 */
   223, /*  320 */
   222, /*  321 */
   221, /*  322 */
   220, /*  323 */
   219, /*  324 */
   218, /*  325 */
   218, /*  326 */
   217, /*  327 */
   216, /*  328 */
   215, /*  329 */
   214, /*  330 */
   213, /*  331 */
   212, /*  332 */
   211, /*  333 */
   211, /*  334 */
   210, /*  335 */
   209, /*  336 */
   208, /*  337 */
   207, /*  338 */
   206, /*  339 */
   205, /*  340 */
   205, /*  341 */
   204, /*  342 */
   203, /*  343 */
   202, /*  344 */
   202, /*  345 */
   201, /*  346 */
   200, /*  347 */
   199, /*  348 */
   198, /*  349 */
   198, /*  350 */
   197, /*  351 */
   196, /*  352 */
   195, /*  353 */
   195, /*  354 */
   194, /*  355 */
   193, /*  356 */
   192, /*  357 */
   192, /*  358 */
   191, /*  359 */
   190, /*  360 */
   190, /*  361 */
   189, /*  362 */
   188, /*  363 */
   187, /*  364 */
   187, /*  365 */
   186, /*  366 */
   186, /*  367 */
   185, /*  368 */
   184, /*  369 */
   184, /*  370 */
   183, /*  371 */
   182, /*  372 */
   182, /*  373 */
   181, /*  374 */
   180, /*  375 */
   180, /*  376 */
   179, /*  377 */
   178, /*  378 */
   178, /*  379 */
   177, /*  380 */
   177, /*  381 */
   176, /*  382 */
   175, /*  383 */
   175, /*  384 */
   174, /*  385 */
   174, /*  386 */
   173, /*  387 */
   172, /*  388 */
   172, /*  389 */
   171, /*  390 */
   171, /*  391 */
   170, /*  392 */
   169, /*  393 */
   169, /*  394 */
   168, /*  395 */
   168, /*  396 */
   167, /*  397 */
   167, /*  398 */
   166, /*  399 */
   166, /*  400 */
   165, /*  401 */
   165, /*  402 */
   164, /*  403 */
   163, /*  404 */
   163, /*  405 */
   162, /*  406 */
   162, /*  407 */
   161, /*  408 */
   161, /*  409 */
   160, /*  410 */
   160, /*  411 */
   159, /*  412 */
   159, /*  413 */
   158, /*  414 */
   158, /*  415 */
   157, /*  416 */
   157, /*  417 */
   156, /*  418 */
   156, /*  419 */
   155, /*  420 */
   155, /*  421 */
   154, /*  422 */
   154, /*  423 */
   153, /*  424 */
   153, /*  425 */
   152, /*  426 */
   152, /*  427 */
   151, /*  428 */
   151, /*  429 */
   150, /*  430 */
   150, /*  431 */
   149, /*  432 */
   149, /*  433 */
   149, /*  434 */
   148, /*  435 */
   148, /*  436 */
   147, /*  437 */
   147, /*  438 */
   146, /*  439 */
   146, /*  440 */
   145, /*  441 */
   145, /*  442 */
   144, /*  443 */
   144, /*  444 */
   143, /*  445 */
   143, /*  446 */
   143, /*  447 */
   142, /*  448 */
   142, /*  449 */
   141, /*  450 */
   141, /*  451 */
   140, /*  452 */
   140, /*  453 */
   140, /*  454 */
   139, /*  455 */
   139, /*  456 */
   138, /*  457 */
   138, /*  458 */
   138, /*  459 */
   137, /*  460 */
   137, /*  461 */
   136, /*  462 */
   136, /*  463 */
   135, /*  464 */
   135, /*  465 */
   135, /*  466 */
   134, /*  467 */
   134, /*  468 */
   133, /*  469 */
   133, /*  470 */
   133, /*  471 */
   132, /*  472 */
   132, /*  473 */
   131, /*  474 */
   131, /*  475 */
   131, /*  476 */
   130, /*  477 */
   130, /*  478 */
   129, /*  479 */
   129, /*  480 */
   129, /*  481 */
   128, /*  482 */
   128, /*  483 */
   128, /*  484 */
   127, /*  485 */
   127, /*  486 */
   126, /*  487 */
   126, /*  488 */
   126, /*  489 */
   125, /*  490 */
   125, /*  491 */
   125, /*  492 */
   124, /*  493 */
   124, /*  494 */
   123, /*  495 */
   123, /*  496 */
   123, /*  497 */
   122, /*  498 */
   122, /*  499 */
   122, /*  500 */
   121, /*  501 */
   121, /*  502 */
   121, /*  503 */
   120, /*  504 */
   120, /*  505 */
   119, /*  506 */
   119, /*  507 */
   119, /*  508 */
   118, /*  509 */
   118, /*  510 */
   118, /*  511 */
   117, /*  512 */
   117, /*  513 */
   116, /*  514 */
   116, /*  515 */
   116, /*  516 */
   115, /*  517 */
   115, /*  518 */
   115, /*  519 */
   114, /*  520 */
   114, /*  521 */
   114, /*  522 */
   113, /*  523 */
   113, /*  524 */
   113, /*  525 */
   112, /*  526 */
   112, /*  527 */
   111, /*  528 */
   111, /*  529 */
   111, /*  530 */
   110, /*  531 */
   110, /*  532 */
   110, /*  533 */
   109, /*  534 */
   109, /*  535 */
   109, /*  536 */
   108, /*  537 */
   108, /*  538 */
   108, /*  539 */
   107, /*  540 */
   107, /*  541 */
   106, /*  542 */
   106, /*  543 */
   106, /*  544 */
   105, /*  545 */
   105, /*  546 */
   105, /*  547 */
   104, /*  548 */
   104, /*  549 */
   104, /*  550 */
   103, /*  551 */
   103, /*  552 */
   103, /*  553 */
   102, /*  554 */
   102, /*  555 */
   101, /*  556 */
   101, /*  557 */
   101, /*  558 */
   100, /*  559 */
   100, /*  560 */
    99, /*  561 */
    99, /*  562 */
    99, /*  563 */
    98, /*  564 */
    98, /*  565 */
    98, /*  566 */
    97, /*  567 */
    97, /*  568 */
    96, /*  569 */
    96, /*  570 */
    95, /*  571 */
    95, /*  572 */
    95, /*  573 */
    94, /*  574 */
    94, /*  575 */
    93, /*  576 */
    93, /*  577 */
    92, /*  578 */
    92, /*  579 */
    91, /*  580 */
    91, /*  581 */
    90, /*  582 */
    90, /*  583 */
    89, /*  584 */
    89, /*  585 */
    88, /*  586 */
    88, /*  587 */
    87, /*  588 */
    86, /*  589 */
    86, /*  590 */
    85, /*  591 */
    84, /*  592 */
    82, /*  593 */
};

void sensor_read(struct capteur* capteurs) {

    /* Lecture de l'Ã©tat des capteurs */
    capteurs->gauche = adc_read(0);
    capteurs->droite = adc_read(1);
}

#include <uart.h>
int16_t distance_value(int16_t capteurs) {
    if(capteurs < 182 || capteurs > 593) return -1;

	capteurs -= 182;
    
    /* Cherche directement dans le tableau la valeur de distance selon le voltage */
    int16_t distance = sensor_tableau[capteurs];
    return distance;
}
